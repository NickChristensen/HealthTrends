{"id":"ht-1892615d","title":"Style chart to match Health app design","description":"Refine the chart styling to match the iOS Health app's visual design. This includes colors, typography, spacing, and overall polish.\n\nReferences available in design-reference/ folder:\n- inspiration.png\n- with-additions.png","acceptance_criteria":"- Chart colors match Health app design\n- Typography and spacing match reference\n- Visual polish complete\n- Design matches reference images","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-16T20:24:45.427546-05:00","updated_at":"2025-11-09T14:15:41.364414-06:00","closed_at":"2025-11-08T22:20:56.040244-06:00","dependencies":[{"issue_id":"ht-1892615d","depends_on_id":"ht-5ecee007","type":"blocks","created_at":"2025-10-16T20:25:01.738129-05:00","created_by":"nick"}]}
{"id":"ht-2eo","title":"Add timer to refresh widget preview data every minute","description":"Widget previews in the app were showing stale \"now\" timestamps (e.g., 5:55pm when current time was 6:21pm). Added a timer that fires every 60 seconds to refresh HealthKit data, ensuring the chart's \"now\" marker and time labels stay current.","acceptance_criteria":"- Widget previews show current time after generating sample data\n- \"Now\" marker updates every minute while app is active\n- Timer only runs when HealthKit is authorized","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-15T18:30:52.604656-06:00","updated_at":"2025-11-15T18:30:56.469908-06:00","closed_at":"2025-11-15T18:30:56.469908-06:00"}
{"id":"ht-3938e6b5","title":"Render Swift Chart in widget timeline","description":"Integrate the Swift Chart visualization into the widget timeline. Reuse existing EnergyChartView code from the main app.\n\nRequirements:\n- Render chart in widget views\n- Update timeline (every 15 min or hourly)\n- Optimize for widget performance\n- Handle all widget size variants","acceptance_criteria":"- Chart renders in widget\n- Timeline updates appropriately\n- Performance is acceptable\n- All widget sizes supported","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-16T20:24:45.584188-05:00","updated_at":"2025-11-15T15:50:55.139205-06:00","closed_at":"2025-11-15T15:50:55.139205-06:00","dependencies":[{"issue_id":"ht-3938e6b5","depends_on_id":"ht-c74f12e0","type":"blocks","created_at":"2025-10-16T20:25:01.777775-05:00","created_by":"nick"},{"issue_id":"ht-3938e6b5","depends_on_id":"ht-fjd","type":"blocks","created_at":"2025-11-09T18:32:53.806197-06:00","created_by":"daemon"}]}
{"id":"ht-3sk","title":"Use latest HealthKit sample timestamp for chart “Now” marker","description":"Follow-up to GH #23. Currently the chart’s “Now” marker is set to the cache write time (i.e., the time we last successfully wrote HealthKit results to the cache). This can be misleading when HealthKit data is delayed (e.g., iPad waiting on iPhone sync or iPhone waiting on Apple Watch). We should investigate and switch the “Now” marker to use the timestamp of the most recent HealthKit sample in the dataset instead of the cache write time, so the chart reflects the actual freshness of the underlying data.\n\nScenarios to consider:\n- iPad shows stale data because iPhone hasn’t synced yet—“Now” should reflect the last HK sample time, not the time we wrote the stale cache.\n- iPhone/Watch gap where no new samples have arrived—marker should stay at last sample time to avoid implying fresh data.\n- Ensure widget/app both use the same logic (shared package) and that fallbacks are sane when no samples are present.","acceptance_criteria":"- “Now” marker uses the timestamp of the most recent HealthKit sample used to build the chart, not the cache write time.\n- Behavior is consistent across app and widget; shared logic is updated in the shared package if applicable.\n- Covers delayed-sync scenarios (iPad, Watch→iPhone gaps) without implying fresher data than exists.\n- Graceful handling when no samples are available (e.g., no marker or clear fallback).","status":"closed","priority":2,"issue_type":"task","assignee":"@me","created_at":"2025-12-06T17:09:33.913527-06:00","updated_at":"2025-12-07T15:21:30.469659-06:00","closed_at":"2025-12-07T15:21:30.469659-06:00"}
{"id":"ht-3y4","title":"Add missing Average PointMarker(s) to widget chart","description":"The widget chart is missing the Average PointMarker(s) that should appear on the average line. These markers should match the implementation in the main app.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-14T12:47:51.705931-06:00","updated_at":"2025-11-15T18:51:07.21152-06:00","closed_at":"2025-11-15T18:51:07.21152-06:00","dependencies":[{"issue_id":"ht-3y4","depends_on_id":"ht-c74f12e0","type":"blocks","created_at":"2025-11-14T12:47:51.706448-06:00","created_by":"daemon"},{"issue_id":"ht-3y4","depends_on_id":"ht-j45","type":"blocks","created_at":"2025-11-14T16:42:01.841011-06:00","created_by":"daemon"}]}
{"id":"ht-4fk","title":"Tweak dark mode colors for better contrast and readability","description":"Dark mode colors need adjustment for better visibility and contrast.\n\n**App Issues:**\n- Overall app is too dark in dark mode\n- Need to brighten UI elements for better readability\n\n**Widget Issues:**\n- Color contrast problems in dark mode - two possible solutions:\n  1. Widget background is too light (darken it), OR\n  2. Average line/statistics colors (gray) are too dark (lighten them)\n- Need to determine which approach gives better visual hierarchy\n- Current gray colors: systemGray, systemGray2, systemGray4, systemGray6\n\n**Affected components:**\n- Widget background color (currently .systemBackground)\n- Average line color (systemGray4 before now, systemGray6 after)\n- Average statistic color (systemGray)\n- Total statistic circle color (systemGray4)\n- App ContentView background/elements\n\n**Goal:**\nEnsure all text, charts, and UI elements are easily readable in dark mode while maintaining visual hierarchy (Today \u003e Average \u003e Total in importance)","status":"closed","priority":2,"issue_type":"task","assignee":"@me","created_at":"2025-11-15T22:24:37.434749-06:00","updated_at":"2025-11-29T10:56:49.453254-06:00","closed_at":"2025-11-29T10:56:49.453254-06:00","external_ref":"GH-3"}
{"id":"ht-4o0","title":"Move development tools to shake-activated sheet","description":"Implement shake gesture detection to show a bottom sheet containing development tools. The sheet will be triggered by shaking the device and will contain the \"Generate Sample Data\" button.\n\nRequirements:\n- Shake gesture (⌃⌘Z in simulator) triggers sheet\n- Sheet appears from bottom with \"Development Tools\" header\n- Generate Sample Data button works in sheet\n- Sheet dismisses properly\n- Only available in simulator builds (#if targetEnvironment(simulator))","design":"Use UIWindow + NotificationCenter pattern for shake detection:\n- Create ShakeGesture.swift with shake detection infrastructure\n- Add .onShake() modifier to ContentView\n- Present sheet with .presentationDetents([.medium]) for partial sheet\n- Sheet header: \"Development Tools\"\n- Sheet content: Generate Sample Data button","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:52:18.713632-06:00","updated_at":"2025-11-09T19:01:12.509379-06:00","closed_at":"2025-11-09T19:01:12.509379-06:00"}
{"id":"ht-542f646c","title":"Investigate x-axis label positioning edge cases","description":"The custom x-axis labels use an overlay with calculated positioning for the current hour label. Need to test how this behaves when current hour is close to start/end of day:\n- 1 AM, 2 AM (close to start of day)\n- 10 PM, 11 PM (close to end of day)\n\nLabels might overlap or need special handling in these edge cases.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-08T15:45:16.243192-06:00","updated_at":"2025-11-09T14:15:41.365596-06:00","closed_at":"2025-11-08T23:54:52.394982-06:00"}
{"id":"ht-5ecee007","title":"Complete Swift Charts integration and commit changes","description":"EnergyChartView has been added to ContentView.swift with chart visualization. Need to test the implementation, update PROJECT_PLAN.md per workflow rules, and commit the changes.\n\nModified files:\n- HelloWorld/ContentView.swift (added EnergyChartView struct)\n- HelloWorld/HealthKitManager.swift (changed mock moveGoal from 1000 to 800)","acceptance_criteria":"- Chart renders correctly in simulator\n- All 4 metrics display properly (Today, Average, Total, Goal)\n- PROJECT_PLAN.md updated with progress\n- Changes committed to git","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-16T20:24:45.370888-05:00","updated_at":"2025-11-09T14:15:41.36382-06:00","closed_at":"2025-11-08T13:44:58.983676-06:00"}
{"id":"ht-5ep","title":"Review and fix widget padding best practices","description":"Need to investigate whether the widget system provides its own padding, as it appears we might be adding padding in the view as well, resulting in double-padding. Should follow iOS widget best practices for content insets.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-14T12:47:51.632477-06:00","updated_at":"2025-11-14T17:21:51.844918-06:00","closed_at":"2025-11-14T17:21:51.844918-06:00","dependencies":[{"issue_id":"ht-5ep","depends_on_id":"ht-c74f12e0","type":"blocks","created_at":"2025-11-14T12:47:51.632983-06:00","created_by":"daemon"},{"issue_id":"ht-5ep","depends_on_id":"ht-j45","type":"blocks","created_at":"2025-11-14T16:42:01.773503-06:00","created_by":"daemon"}]}
{"id":"ht-61k","title":"Add floating button to trigger development tools sheet","description":"Add a floating button in the bottom right corner of the app to trigger the development tools sheet. Button should use the `wrench.and.screwdriver` SF Symbol and be positioned properly using SwiftUI layout techniques.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-14T20:57:33.541723-06:00","updated_at":"2025-11-14T22:09:25.070653-06:00","closed_at":"2025-11-14T22:09:25.070653-06:00"}
{"id":"ht-6c384d70","title":"Fix time calculations for current hour data display","description":"We need to fix how we're treating times to fix two bugs, likely closely related:\n\n1. In our Today data series, the current hour (ie when the time is 12:30, the 12pm hour) shows a vertical cliff (upward) on the chart. That would indicate to me that we have two values for the current hour, maybe start of hour and now? We should treat the start of the current hour as the end of our Today data, as the current hour is not finished yet and we don't know where it will finish.\n\n2. In our Average data series, we are showing nothing for the current hour. Ie when the time is 12:30, there is a gap between 12pm and 1pm on the graph","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T12:31:55.973698-06:00","updated_at":"2025-11-09T14:15:41.364797-06:00","closed_at":"2025-11-09T13:16:39.734464-06:00"}
{"id":"ht-6mn","title":"Widget displays stale NOW points from cached data","description":"Root cause analysis for GH-7:\n\nThe widget reads cached data from shared container that includes NOW points (interpolated average, current hour progress) from when app last updated. When widget refreshes every 15 minutes, it re-reads the same stale data.\n\nTwo problems:\n1. averageHourlyData contains interpolated NOW point from old time (partially fixed by cleanedAverageData filter)\n2. todayHourlyData contains current hour progress point from old time (NOT filtered)\n\nSolution: Widget should either:\nA. Recalculate NOW points based on widget's current time, OR\nB. Filter out ALL NOW points (minute != 0) and let EnergyChartView computed properties regenerate them\n\nOption B is cleaner and leverages our refactored computed properties.","design":"## Final Approved Approach: Hybrid Widget HealthKit Queries\n\nAfter discussion with user and ios-developer analysis, implementing hybrid approach that balances accuracy and battery life.\n\n### Architecture Decision\n\n1. **Today's Data**: Always fetch hourly breakdown from HealthKit (fresh, 50-150ms query)\n2. **Average Data**: Cache 30-day pattern, refresh once per day after 6 AM\n3. **Widget Refresh**: Every 15 minutes, no interpolation guesses\n\n### Why This Approach\n\n- 97% battery reduction vs full queries (1.9s vs 64s CPU/day)\n- Real data for today (no guessing)\n- Average data stable (minimal changes day-to-day)\n- iOS-friendly refresh pattern (won't throttle)\n- Simple, maintainable code\n\n### Implementation Plan\n\n**Phase 1: Shared HealthKit Query Service**\n- Extract query logic from HealthKitManager into shared framework\n- Create `fetchTodayHourlyTotals()` - efficient hourly query\n- Make reusable by both app and widget\n\n**Phase 2: Average Data Cache Manager**\n- Create `AverageDataCache` struct (Codable)\n- Implement cache read/write to App Group container\n- Staleness detection (refresh after midnight, after 6 AM)\n- Graceful degradation for missing/corrupt cache\n\n**Phase 3: Widget Timeline Provider Updates**\n- Add HealthKit entitlements to widget target\n- Update timeline provider to:\n  - Load cached average data (or refresh if stale)\n  - Query today's hourly breakdown\n  - Compose entry with real data\n- Handle errors with fallback to cached/placeholder\n\n**Phase 4: Testing**\n- Edge cases: midnight boundary, hour boundaries, cache miss\n- Device testing (simulator doesn't support widget HealthKit)\n- Battery monitoring\n- iOS throttling behavior\n\n### Complexity \u0026 Timeline\n- **Effort**: 4-6 hours development + testing\n- **Risk**: Low-medium (well-understood iOS patterns)\n- **Battery Impact**: Negligible (30ms per refresh)","notes":"## iOS Developer Analysis (2025-11-23)\n\n### Current Architecture\n1. **App's HealthKitManager**: Fetches fresh data, creates interpolated NOW points, writes to shared container\n2. **Widget's Timeline Provider**: Reads cached data every 15 minutes (no HealthKit queries - battery-friendly)\n3. **EnergyChartView** (after refactor):\n   - ✅ `cleanedAverageData`: Filters stale NOW points (minute != 0)\n   - ✅ `interpolatedAverageAtNow`: Recalculates fresh NOW point\n   - ❌ `todayLine`: Uses `todayHourlyData` directly (includes stale NOW point)\n   - ❌ `todayPoint`: Uses last point from `todayHourlyData` (stale timestamp AND calories)\n\n### The Problem\nWhen widget refreshes at 3:15 PM but app last ran at 2:37 PM:\n- Average line: Correctly shows current time (thanks to refactor)\n- Today line: Shows 2:37 PM point as if it's current\n- Visual: Lines/points misaligned, looks broken\n\n### Recommended Solution: Smart Interpolation with Sanity Checks\n\nAdd computed properties similar to average data handling:\n\n```swift\n/// Cleaned today data (removes stale NOW points)\nprivate var cleanedTodayData: [HourlyEnergyData] {\n    todayHourlyData.filter { data in\n        let minute = calendar.component(.minute, from: data.hour)\n        let second = calendar.component(.second, from: data.hour)\n        return minute == 0 \u0026\u0026 second == 0\n    }\n}\n\n/// Today data with interpolated current hour progress\nprivate var todayDataWithNow: [HourlyEnergyData] {\n    var data = cleanedTodayData\n    \n    guard let lastCompleteHour = data.last,\n          let cachedCurrentProgress = todayHourlyData.last,\n          calendar.component(.minute, from: cachedCurrentProgress.hour) != 0 else {\n        return data\n    }\n    \n    let currentHour = calendar.component(.hour, from: now)\n    let cachedHour = calendar.component(.hour, from: cachedCurrentProgress.hour)\n    \n    // Only interpolate if still in same hour\n    guard currentHour == cachedHour else {\n        return data  // Conservative: use last complete hour\n    }\n    \n    let cachedMinute = calendar.component(.minute, from: cachedCurrentProgress.hour)\n    let currentMinute = calendar.component(.minute, from: now)\n    \n    // Don't extrapolate backwards\n    guard currentMinute \u003e cachedMinute else {\n        data.append(HourlyEnergyData(hour: now, calories: cachedCurrentProgress.calories))\n        return data\n    }\n    \n    // Calculate burn rate and extrapolate\n    let caloriesInPartialHour = cachedCurrentProgress.calories - lastCompleteHour.calories\n    let cachedProgress = Double(cachedMinute) / 60.0\n    let currentProgress = Double(currentMinute) / 60.0\n    \n    if cachedProgress \u003e 0 {\n        let burnRate = caloriesInPartialHour / cachedProgress\n        let estimatedPartialHourCalories = burnRate * currentProgress\n        let estimatedCurrentCalories = lastCompleteHour.calories + estimatedPartialHourCalories\n        \n        // Cap at 400 cal/hour (elite athlete max)\n        let maxReasonableHourlyBurn = 400.0\n        let maxAllowedCalories = lastCompleteHour.calories + maxReasonableHourlyBurn\n        \n        if estimatedCurrentCalories \u003e maxAllowedCalories {\n            let conservativeCalories = lastCompleteHour.calories + (maxReasonableHourlyBurn * currentProgress)\n            data.append(HourlyEnergyData(hour: now, calories: conservativeCalories))\n        } else {\n            data.append(HourlyEnergyData(hour: now, calories: estimatedCurrentCalories))\n        }\n    } else {\n        data.append(HourlyEnergyData(hour: now, calories: lastCompleteHour.calories))\n    }\n    \n    return data\n}\n```\n\nThen update chart rendering:\n```swift\n@ChartContentBuilder\nprivate var todayLine: some ChartContent {\n    ForEach(todayDataWithNow) { data in  // Changed from todayHourlyData\n        LineMark(...)\n    }\n}\n\n@ChartContentBuilder\nprivate var todayPoint: some ChartContent {\n    if let last = todayDataWithNow.last {  // Changed from todayHourlyData\n        PointMark(x: .value(\"Hour\", last.hour), y: .value(\"Calories\", last.calories))...\n    }\n}\n```\n\n### Why This Approach?\n\n**Pros:**\n- ✅ Battery-friendly (no widget HealthKit queries)\n- ✅ More accurate than stale data\n- ✅ Handles edge cases (hour boundaries, clock adjustments, unrealistic burn rates)\n- ✅ Conservative fallbacks prevent wrong estimates\n- ✅ Consistent with average line interpolation\n- ✅ Aligns with iOS widget best practices\n\n**Edge Cases Handled:**\n1. **DST transitions**: Calendar-aware component comparison handles correctly\n2. **Timezone changes**: Acceptable limitation until app reopens\n3. **Clock adjustments**: `currentMinute \u003e cachedMinute` check catches backwards time\n4. **Hour boundary crossing**: Falls back to last complete hour\n5. **App hasn't run today**: Could add separate check for this scenario\n\n### Alternative Considered: Widget HealthKit Queries\nRejected because:\n- Battery drain\n- Goes against Apple widget design philosophy (widgets should be lightweight)\n- Adds complexity with two codepaths querying HealthKit\n- Privacy concerns\n\n### Accuracy Impact\n- Within same hour: Excellent (±5-10 cal typical)\n- Hour boundary crossed: Conservative (shows last complete hour)\n- Extreme cases: Safe fallbacks prevent wildly wrong data","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-23T15:35:07.165503-06:00","updated_at":"2025-11-23T16:38:09.110295-06:00","closed_at":"2025-11-23T16:38:09.110295-06:00","external_ref":"GH-7"}
{"id":"ht-7ok","title":"Create WidgetPreviewContainer component","description":"Build a reusable container that renders content at widget dimensions with proper styling. Includes dynamic size calculation based on screen width, support for medium and large families, corner radius matching widget style, and shadow for visual distinction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T19:39:25.981288-06:00","updated_at":"2025-11-09T19:40:17.334358-06:00","closed_at":"2025-11-09T19:40:17.334358-06:00"}
{"id":"ht-9ya","title":"Refactor app architecture: simplify app now that widget UI is separated","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-01T11:50:03.623581-06:00","updated_at":"2025-12-01T11:50:38.902776-06:00","closed_at":"2025-12-01T11:50:38.902776-06:00"}
{"id":"ht-9zt","title":"Refactor magic label widths to use actual text measurements","description":"Currently using hardcoded label widths for collision detection:\n- nowLabelWidth: 50px (for labels like \"6:10 AM\")\n- startEndLabelWidth: 35px (for labels like \"12 AM\")\n\nThese are approximations. Should measure actual text width using SwiftUI's\nGeometryReader or Text measurement APIs for more accurate collision detection.\n\nThis will prevent edge cases where labels might collide or have unnecessary\nspacing due to inaccurate width estimates.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-13T21:00:19.035107-06:00","updated_at":"2025-11-15T20:29:48.867201-06:00","closed_at":"2025-11-15T20:29:48.867201-06:00"}
{"id":"ht-c2u","title":"Debug line appearing at or below chart X axis","description":"There is an unwanted line rendering at the bottom of or below the chart X axis that needs to be investigated and removed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T18:29:08.661414-06:00","updated_at":"2025-11-09T18:41:23.509713-06:00","closed_at":"2025-11-09T18:41:23.509713-06:00"}
{"id":"ht-c74f12e0","title":"Create widget extension for home screen","description":"Add a Widget Extension target to display the energy trends chart on the iOS home screen.\n\nRequirements:\n- Add Widget Extension target in Xcode\n- Set up App Groups for sharing HealthKit data between app and widget\n- Create Widget timeline provider\n- Handle different widget sizes (small/medium/large)","acceptance_criteria":"- Widget Extension target created\n- App Groups configured\n- Timeline provider implemented\n- Widget displays in widget gallery","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-16T20:24:45.518019-05:00","updated_at":"2025-11-14T16:45:44.322779-06:00","closed_at":"2025-11-14T16:45:44.322779-06:00","dependencies":[{"issue_id":"ht-c74f12e0","depends_on_id":"ht-1892615d","type":"related","created_at":"2025-10-16T20:25:01.820664-05:00","created_by":"nick"},{"issue_id":"ht-c74f12e0","depends_on_id":"ht-fjd","type":"blocks","created_at":"2025-11-09T18:32:56.282172-06:00","created_by":"daemon"}]}
{"id":"ht-cbq","title":"Rework medium widget layout to give more room for graph","description":"The medium widget layout feels cramped - the chart doesn't have enough vertical space to be easily readable at a glance.\n\nCurrent layout issues:\n- Header statistics take up too much vertical space\n- Chart is compressed, making it harder to read trends\n- Could optimize spacing between elements\n\nPotential improvements:\n- Reduce header statistics font size or spacing\n- Make the chart taller (more vertical space)\n- Consider alternative layouts (stack statistics differently?)\n- Ensure all data remains readable while maximizing chart space","status":"closed","priority":2,"issue_type":"task","assignee":"@me","created_at":"2025-11-15T22:06:28.257241-06:00","updated_at":"2025-12-09T16:06:49.178072-06:00","closed_at":"2025-12-09T16:06:49.178072-06:00","external_ref":"GH-4"}
{"id":"ht-cme","title":"Create an icon","description":"Design and implement a custom app icon for HealthTrends. Currently using the default Xcode placeholder icon.\n\nThe icon should:\n- Represent health/fitness/energy tracking\n- Work well at all iOS icon sizes\n- Follow iOS design guidelines\n- Be visually distinct and recognizable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-15T22:06:11.186783-06:00","updated_at":"2025-11-23T11:48:09.121623-06:00","closed_at":"2025-11-23T11:48:09.121623-06:00","external_ref":"GH-5"}
{"id":"ht-coq","title":"Refactor EnergyTrendView to use flexible layout","description":"Refactor EnergyTrendView and EnergyChartView to use VStack with flexible height distribution:\n- Header with statistics: fixed height\n- Chart: flexible height (takes remaining space)\n- X-axis labels: fixed height\n\nThis will make the view adapt better to different container sizes (especially for widgets).","design":"Use VStack with maxHeight: .infinity on container and chart.\nExtract x-axis labels from overlay into separate fixed-height component.\nRemove hardcoded chart height (chartHeight: CGFloat = 300).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T19:50:58.413223-06:00","updated_at":"2025-11-09T19:55:38.828123-06:00","closed_at":"2025-11-09T19:55:38.828123-06:00"}
{"id":"ht-cxt","title":"Rename HelloWorld (product?) to HealthTrends","description":"Rename the product/project from \"HelloWorld\" to \"HealthTrends\" throughout the codebase. This includes:\n- Xcode project and scheme names\n- Bundle identifiers\n- Product names in Info.plist\n- Display names\n- Any references in code/comments\n- Documentation\n- Repository/folder names (if applicable)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-15T20:38:04.220284-06:00","updated_at":"2025-11-15T21:11:33.395332-06:00","closed_at":"2025-11-15T21:11:33.395332-06:00"}
{"id":"ht-ebj","title":"Discrepancy between Today/Average relative position in graph vs header","description":"There's a potential discrepancy between the relative vertical position of Today/Average on the graph versus the statistics shown in the header.\n\nFor example: sometimes the graph shows Today above Average, but the header shows the opposite (Today \u003c Average).\n\nRoot cause: The header uses the current real-time total, while the graph uses the total as of the beginning of the hour. This creates a mismatch when the values are close and the current hour is still in progress.","acceptance_criteria":"- Graph and header show consistent relative ordering of Today vs Average\n- Either both use current total, or both use beginning-of-hour total\n- Visual representation matches the numeric statistics","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-12T12:43:10.118962-06:00","updated_at":"2025-11-13T21:01:39.974863-06:00","closed_at":"2025-11-13T21:01:39.974863-06:00"}
{"id":"ht-fdq","title":"Fix widget refresh timer - widgets don't auto-refresh","description":"The app and widget refresh pipeline needs to be rethought. Currently:\n\n**App Issues:**\n- App has a 1-minute timer that maybe pulls health data, but the chart never redraws\n- Chart doesn't update when app is activated/foregrounded\n- Visual data appears stale even if underlying data is fresh\n\n**Widget Issues:**\n- Widget doesn't seem to refresh at all\n- Not clear when/how widget updates should happen\n\n**Questions to investigate:**\n- When is it possible to refresh widgets? (app activation, backgrounding, time-based?)\n- What are the best practices for widget refresh timing?\n- Are there iOS limitations on refresh frequency?\n\n**Desired behavior:**\n- **App should:** Refresh health data AND redraw chart when activated/foregrounded\n- **App should:** Refresh health data AND redraw chart every minute (timer already exists?)\n- **Widget should:** Refresh when ??? (need to determine what's possible and recommended)\n- **Widget should:** Write updated data to shared container so widget can read it\n\nNeed to audit the entire data flow:\n1. HealthKitManager pulls data → writes to shared container\n2. App reads from HealthKitManager → updates UI\n3. Widget reads from shared container → displays in timeline\n4. When does each step happen?","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-15T22:06:16.860242-06:00","updated_at":"2025-11-16T16:35:10.361352-06:00","closed_at":"2025-11-16T16:35:10.361352-06:00","external_ref":"GH-2","dependencies":[{"issue_id":"ht-fdq","depends_on_id":"ht-sbm","type":"blocks","created_at":"2025-11-16T14:49:35.577481-06:00","created_by":"nick"},{"issue_id":"ht-fdq","depends_on_id":"ht-xnl","type":"blocks","created_at":"2025-11-16T14:49:41.214443-06:00","created_by":"nick"},{"issue_id":"ht-fdq","depends_on_id":"ht-fnn","type":"blocks","created_at":"2025-11-16T14:49:46.928209-06:00","created_by":"nick"}]}
{"id":"ht-fjd","title":"Extract header with statistics and chart into reusable view","description":"Move the header with statistics and chart components into a single, reusable view that can be shared between the main app and widgets. This should not include development tools.","design":"Evaluate whether to use an existing view or create a new encapsulating view. The solution should:\n- Combine the header statistics display with the chart\n- Be reusable across the main app and widget contexts\n- Exclude any development tools\n- Follow SwiftUI best practices for view composition","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:32:40.482182-06:00","updated_at":"2025-11-09T18:39:23.601025-06:00","closed_at":"2025-11-09T18:39:23.601025-06:00"}
{"id":"ht-fnn","title":"Optimize timer to use calculated minute boundaries","description":"Current 1-second polling timer works but causes 3600 wake-ups/hour vs 60 with calculated timer.\n\nOptional optimization: Calculate time until next minute boundary and use dynamic timer scheduling. Low priority - current approach is acceptable.","notes":"Analysis from iOS developer agent:\n\n**Energy Impact:**\n- Current timer overhead: ~5% of total app energy (HealthKit fetches are 95%)\n- 3540 early exits/hour = only 3.54ms total CPU time (trivial)\n- In foreground: Display refresh (60-120 Hz) already causes far more wake-ups\n\n**Code Complexity Trade-off:**\n- Current: 9 lines, 1 state variable, simple\n- Optimized: 35-40 lines, 2 state variables, lifecycle management, timer rescheduling\n\n**Recommendation: Won't Implement**\nThe complexity cost (35+ lines, lifecycle bugs, edge cases) far outweighs the minimal energy savings (~5% of foreground energy). Current implementation is optimal for this use case.\n\nApple's \"minimize timer use\" guidance targets background polling and heavy work on each fire. Our early exits are trivial integer comparisons while app is in foreground with CPU already awake for UI rendering.\n\n**Principle:** Don't prematurely optimize what isn't a bottleneck.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-16T14:49:19.331335-06:00","updated_at":"2025-11-16T16:34:42.203293-06:00","closed_at":"2025-11-16T16:34:42.203293-06:00"}
{"id":"ht-ftf","title":"Rework ContentView from dev tool to user-friendly experience","description":"ContentView currently shows widget previews and dev tools, which isn't user-friendly. Need to redesign for actual users.\n\nCurrent issues:\n- Widget preview containers are developer-focused, not useful for end users\n- Health permissions are requested automatically without explanation\n- No onboarding or explanation of what the app does\n- Dev tools (wrench icon) are always visible\n\nProposed improvements:\n- Add proper onboarding flow explaining the app's purpose\n- Create a permissions request screen that:\n  - Explains WHY we need Health data access\n  - Shows what data we access (active energy only)\n  - Has a clear \"Grant Access\" button instead of automatic request\n- Consider what users actually want to see in the main app:\n  - Detailed stats view?\n  - Historical trends?\n  - Goal setting?\n  - Just show the widgets in a better format?\n- Move dev tools behind a hidden gesture or settings screen","status":"closed","priority":1,"issue_type":"feature","assignee":"@me","created_at":"2025-11-15T22:06:22.528062-06:00","updated_at":"2025-11-30T21:49:33.703112-06:00","closed_at":"2025-11-30T21:49:33.703112-06:00","external_ref":"GH-1"}
{"id":"ht-ie8","title":"Fix Average lines discontinuity at NOW marker","description":"The darker average line (representing the day up to now) ends at a higher point than where the lighter average line (rest of day going forward) begins. These two segments should meet seamlessly at the NOW marker without a gap or discontinuity.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-14T12:47:51.777961-06:00","updated_at":"2025-11-15T17:43:20.769084-06:00","closed_at":"2025-11-15T17:43:20.769084-06:00","dependencies":[{"issue_id":"ht-ie8","depends_on_id":"ht-j45","type":"blocks","created_at":"2025-11-14T16:42:01.904669-06:00","created_by":"daemon"}]}
{"id":"ht-j45","title":"Refactor shared code architecture between app and widget","description":"Currently the widget target includes entire files (HealthKitManager.swift, ContentView.swift, ShakeGesture.swift) when it only needs specific types and views. This creates unnecessary dependencies, tight coupling, and unclear boundaries between shared vs app-specific code.\n\nProblems:\n- Widget includes HealthKitManager.swift just to get HourlyEnergyData struct (exposes all HealthKit logic it doesn't need)\n- Widget includes ContentView.swift just to get EnergyTrendView/EnergyChartView/HeaderStatistic (includes app-specific code like ContentView, DevelopmentToolsSheet, simulator blocks)\n- Widget includes ShakeGesture.swift (doesn't need this at all)\n- No clear boundaries between shared vs app-specific code\n- Difficulty understanding what the widget actually depends on\n\nAcceptance Criteria:\n- Models extracted to Models/ directory\n- Shared views extracted to Views/Shared/ directory\n- App-specific views in Views/App/ directory\n- Widget target only includes necessary shared files\n- Widget no longer depends on HealthKitManager.swift or ShakeGesture.swift\n- All code compiles and runs correctly\n- Widget continues to function as expected\n- Clear separation of concerns between shared and app-specific code","design":"## Recommended Approach: File Reorganization\n\nSplit monolithic files into focused, single-responsibility files organized by feature/layer.\n\n### Directory Structure\n```\nHelloWorld/\n├── Models/\n│   ├── HourlyEnergyData.swift           [App + Widget]\n│   └── SharedEnergyData.swift           [App + Widget]\n├── Views/\n│   ├── Shared/                          [App + Widget]\n│   │   ├── EnergyChartView.swift\n│   │   ├── EnergyTrendView.swift\n│   │   └── HeaderStatistic.swift\n│   └── App/                             [App only]\n│       ├── ContentView.swift\n│       └── DevelopmentToolsSheet.swift\n├── Managers/\n│   ├── HealthKitManager.swift           [App only]\n│   └── SharedEnergyDataManager.swift    [App + Widget]\n└── Utilities/\n    ├── ShakeGesture.swift               [App only]\n    └── WidgetPreviewContainer.swift     [App + Widget - previews only]\n\nDailyActiveEnergyWidget/\n└── DailyActiveEnergyWidget.swift        [Widget only]\n```\n\n### Key Changes\n\n1. **Extract HourlyEnergyData to separate file**\n   - Create Models/HourlyEnergyData.swift\n   - Remove from HealthKitManager.swift\n   - Widget no longer needs HealthKit dependency\n\n2. **Extract shared views to Views/Shared/**\n   - EnergyChartView.swift (chart visualization)\n   - HeaderStatistic.swift (statistic component)\n   - EnergyTrendView.swift (combined view)\n   - Remove from ContentView.swift\n\n3. **Keep app-specific code in Views/App/**\n   - ContentView.swift (main app UI, preview containers)\n   - DevelopmentToolsSheet.swift (simulator dev tools)\n\n4. **Widget target membership**\n   After refactoring, widget should ONLY include:\n   - ✅ Models/HourlyEnergyData.swift\n   - ✅ Models/SharedEnergyData.swift\n   - ✅ Views/Shared/*.swift\n   - ✅ Managers/SharedEnergyDataManager.swift\n   - ❌ NOT HealthKitManager.swift\n   - ❌ NOT ShakeGesture.swift\n   - ❌ NOT ContentView.swift (app-specific)\n\n### Optional Enhancement: View Data Model\n\nConsider creating EnergyTrendData.swift to simplify EnergyTrendView's 6-parameter signature:\n\n```swift\nstruct EnergyTrendData {\n    let todayTotal: Double\n    let averageAtCurrentHour: Double\n    let projectedTotal: Double\n    let moveGoal: Double\n    let todayHourlyData: [HourlyEnergyData]\n    let averageHourlyData: [HourlyEnergyData]\n}\n\nstruct EnergyTrendView: View {\n    let data: EnergyTrendData  // Instead of 6 parameters\n}\n```\n\n### Future Option: Swift Package\n\nIf we add more widgets or want stricter boundaries, consider extracting to a local Swift Package (HealthTrendsKit). This enforces clean boundaries and makes shared code independently testable. For now, file reorganization provides 80% of benefits with minimal disruption.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-14T16:39:36.191245-06:00","updated_at":"2025-11-14T17:07:16.482247-06:00","closed_at":"2025-11-14T17:07:16.482247-06:00"}
{"id":"ht-llv","title":"Create type-safe color system to replace string-based color lookups","description":"Currently, colors are referenced using string literals like Color(\"AccentColor\"), which lacks compile-time safety and autocomplete support. Implement a type-safe color system similar to SwiftUI's pattern (Color.primary) that provides:\n- Compile-time safety\n- Autocomplete support\n- Organized namespaces (e.g., Color.chart.goal, Color.appTheme.accent)\n- Easy refactoring\n\nCurrent colors to migrate:\n- AccentColor, AverageStatisticColor, TotalStatisticTextColor, TotalStatisticCircleColor\n- GoalLineColor, NowLineColor, AverageLineBeforeNowColor, AverageLineAfterNowColor\n- WidgetBackground","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T21:32:34.030435-06:00","updated_at":"2025-12-09T21:32:34.030435-06:00","external_ref":"GH-40"}
{"id":"ht-rrn","title":"Update ContentView to show widget previews","description":"Replace main content with widget preview display. Create vertical stack of preview containers with labels, render EnergyTrendView inside each preview, and pass HealthKit data to previews.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T19:39:26.069606-06:00","updated_at":"2025-11-09T19:40:46.082914-06:00","closed_at":"2025-11-09T19:40:46.082914-06:00","dependencies":[{"issue_id":"ht-rrn","depends_on_id":"ht-7ok","type":"blocks","created_at":"2025-11-09T19:39:44.236984-06:00","created_by":"daemon"}]}
{"id":"ht-sbm","title":"Fix widget timeline to use single entry with .after() policy","description":"Widget timeline currently generates 16 entries (every 15 min for 4 hours) but they all read the same stale data from shared container. This prevents widgets from auto-refreshing when app is backgrounded.\n\nChange to single timeline entry with .after(nextUpdate) policy so WidgetKit automatically re-runs getTimeline() every 15 minutes to fetch fresh data.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-16T14:48:58.381711-06:00","updated_at":"2025-11-16T16:16:49.351979-06:00","closed_at":"2025-11-16T16:16:49.351979-06:00"}
{"id":"ht-unu","title":"Total label not aligned with Total line after dynamic height change","description":"The \"Total\" label in the overlay layer is not properly positioned vertically relative to the Total line on the graph. This issue appeared after making the view height dynamic.\n\nThe label should be vertically aligned with the Total line on the chart, but is currently misaligned.","acceptance_criteria":"- Total label is vertically aligned with the Total line on the chart\n- Alignment is maintained across different view heights\n- Label remains properly positioned when view height changes dynamically","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-12T12:36:55.439281-06:00","updated_at":"2025-11-12T14:11:41.169465-06:00","closed_at":"2025-11-12T14:11:41.169465-06:00"}
{"id":"ht-vss","title":"Improve authorization verification to prevent stuck permission button","description":"After granting HealthKit permissions, the 'Grant Health Access' button sometimes remains visible instead of disappearing. Current implementation only checks SharedEnergyData cache existence, which may not exist immediately after first authorization.\n\nCurrent Implementation (HealthKitManager.swift:67-87):\n- verifyReadAuthorization() only checks if SharedEnergyData cache exists\n- Returns false if cache missing (assumes unauthorized)\n- Problem: On first run after granting permission, cache doesn't exist yet until first data fetch completes\n\nProposed Fix:\nauthorizationGranted = averageCacheIsNotEmpty || todayCacheIsNotEmpty || simpleFallbackQueryToRequestOneSample()\n\nRationale:\n1. Average cache exists → user definitely authorized (cache refreshed daily)\n2. Today cache exists → user definitely authorized (refreshed every 15 min)\n3. No cache → perform minimal HealthKit query (1 sample) to verify permission\n\nAdditional UI requirement:\n- Show button with spinner/loading state while verification checks run\n- Only show 'Grant Access' when verification definitively returns false\n\nFiles to modify:\n- HealthTrends/Managers/HealthKitManager.swift (verifyReadAuthorization)\n- HealthTrends/Views/App/ContentView.swift (add loading state to button)","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-06T14:00:11.127116-06:00","updated_at":"2025-12-06T14:00:11.127116-06:00"}
{"id":"ht-w93","title":"Refactor app architecture: simplify app now that widget UI is separated","description":"## Context\n\n**Historical Evolution:**\n- Initially: App had simulated widget UI in ContentView for quick iteration during development\n- MVP phase: Created actual widget extension, moved code to shared locations (HealthKit access, permissions, widget updates)\n- Issue ht-ftf / GitHub #1: Removed simulated widget UI from app entirely\n\n**Current State:**\n- App exists primarily to grant HealthKit access and authorization\n- All HealthKit queries, data processing, and UI now live exclusively in the widget\n- Shared code exists that was necessary when app had widget UI, but may no longer be needed\n\n**Future State:**\n- Multiple widgets planned that will use HealthKit data\n- Shared HealthKit access/authorization logic will still be necessary across widgets\n\n## Refactor Goals\n\n1. **Simplify app target:** Remove unnecessary code now that app is authorization-only\n2. **Consolidate widget logic:** Move widget-specific code out of shared locations if not needed by future widgets\n3. **Keep shared HealthKit core:** Maintain shared authorization, permissions, and base query logic for multiple future widgets\n4. **Clean architecture:** Clear separation between app (authorization), shared (multi-widget HealthKit), and widget (specific implementations)\n\n## Areas to Review\n\n- HealthKitManager: Is this still needed in app, or can it be simplified?\n- SharedEnergyDataManager: Still needed for app-widget communication?\n- HealthKitQueryService: Should remain shared for multiple widgets\n- App ContentView: Should be minimal authorization UI only\n- Widget-specific logic: Should live in widget target, not shared\n\n## Success Criteria\n\n- Clear architectural boundaries\n- No dead code or unnecessary sharing\n- Foundation ready for multiple widgets\n- App is simple authorization-only interface\n\n---\nGitHub issue: #20","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-01T11:50:44.087335-06:00","updated_at":"2025-12-01T11:52:51.838564-06:00"}
{"id":"ht-xnl","title":"Replace lastRefreshTime with objectWillChange.send()","description":"Currently using @Published var lastRefreshTime just to force UI re-renders, which pollutes the data model with non-semantic properties.\n\nBetter pattern: Use objectWillChange.send() explicitly in fetchEnergyData() to trigger view updates, then remove lastRefreshTime property entirely.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-16T14:49:13.67519-06:00","updated_at":"2025-11-16T16:21:29.144705-06:00","closed_at":"2025-11-16T16:21:29.144705-06:00"}
{"id":"ht-zir","title":"Fix widget background color to match app background","description":"The widget view doesn't set an explicit background color, causing the widget background to appear darker than the app background in light mode. The view should set an appropriate background color to match the app's appearance.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-14T12:47:51.55026-06:00","updated_at":"2025-11-14T17:21:51.763185-06:00","closed_at":"2025-11-14T17:21:51.763185-06:00","dependencies":[{"issue_id":"ht-zir","depends_on_id":"ht-c74f12e0","type":"blocks","created_at":"2025-11-14T12:47:51.551653-06:00","created_by":"daemon"},{"issue_id":"ht-zir","depends_on_id":"ht-j45","type":"blocks","created_at":"2025-11-14T16:42:01.70016-06:00","created_by":"daemon"}]}
